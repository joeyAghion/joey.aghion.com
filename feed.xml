<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Half a Mind - Joey Aghion</title>
  <id>http://joey.aghion.com</id>
  <link href="http://joey.aghion.com"/>
  <link href="http://joey.aghion.com/feed.xml" rel="self"/>
  <updated>2014-01-30T16:38:00Z</updated>
  <author>
    <name>Joey Aghion</name>
  </author>
  <entry>
    <title>New Artsy post: Isolating Spurious and Nondeterministic Tests</title>
    <link rel="alternate" href="/new-artsy-post-isolating-spurious-and-nondeterministic-tests/"/>
    <id>/new-artsy-post-isolating-spurious-and-nondeterministic-tests/</id>
    <published>2014-01-30T16:38:00Z</published>
    <updated>2014-01-30T16:38:00Z</updated>
    <author>
      <name>Joey Aghion</name>
    </author>
    <summary type="html">&lt;p&gt;Solid tests are a great asset. Tests that fail spurously are toxic; they threaten our ability to ship quickly and our confidence in the end product.&lt;/p&gt;

&lt;p&gt;We&amp;#8217;re now experimenting with a test &amp;#8220;quarantine&amp;#8221;&amp;#8211;a suite of problematic tests that&amp;#8217;s isolated from the usual build pipeline and limited in size.&lt;/p&gt;</summary>
    <content type="html">&lt;p&gt;Solid tests are a great asset. Tests that fail spurously are toxic; they threaten our ability to ship quickly and our confidence in the end product.&lt;/p&gt;

&lt;p&gt;We&amp;#8217;re now experimenting with a test &amp;#8220;quarantine&amp;#8221;&amp;#8211;a suite of problematic tests that&amp;#8217;s isolated from the usual build pipeline and limited in size.&lt;/p&gt;

&lt;p&gt;Read more on the Artsy engineering blog: &lt;a href='http://artsy.github.io/blog/2014/01/30/isolating-spurious-and-nondeterministic-tests/'&gt;Isolating Spurious and Nondeterministic Tests&lt;/a&gt;&lt;/p&gt;</content>
  </entry>
  <entry>
    <title>Let console_color keep you out of trouble</title>
    <link rel="alternate" href="/let-console_color-keep-you-out-of-trouble/"/>
    <id>/let-console_color-keep-you-out-of-trouble/</id>
    <published>2013-11-22T14:38:00Z</published>
    <updated>2013-11-22T14:38:00Z</updated>
    <author>
      <name>Joey Aghion</name>
    </author>
    <summary type="html">&lt;p&gt;Who hasn&amp;#8217;t mistakenly typed into a production Rails console thinking it was development?&lt;/p&gt;

&lt;p&gt;Introducing &lt;a href='https://github.com/joeyAghion/console_color'&gt;console_color&lt;/a&gt;, so you&amp;#8217;re never unsure of your environment. To install, add &lt;code&gt;console_color&lt;/code&gt; to your Gemfile:&lt;/p&gt;</summary>
    <content type="html">&lt;p&gt;Who hasn&amp;#8217;t mistakenly typed into a production Rails console thinking it was development?&lt;/p&gt;

&lt;p&gt;Introducing &lt;a href='https://github.com/joeyAghion/console_color'&gt;console_color&lt;/a&gt;, so you&amp;#8217;re never unsure of your environment. To install, add &lt;code&gt;console_color&lt;/code&gt; to your Gemfile:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;gem &amp;#39;console_color&amp;#39;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Your console will look like:&lt;/p&gt;

&lt;p&gt;&lt;img alt='production console' src='http://f.cl.ly/items/3U2M3c1c230s0S2X3n22/Screen%20Shot%202013-11-22%20at%2012.06.43%20AM.png' /&gt;&lt;/p&gt;

&lt;p&gt;I.e., DANGER. Or:&lt;/p&gt;

&lt;p&gt;&lt;img alt='development console' src='http://f.cl.ly/items/3j1o3w3N1E382a211d1P/Screen%20Shot%202013-11-21%20at%2011.48.18%20PM.png' /&gt;&lt;/p&gt;

&lt;p&gt;Sure&amp;#8211;it&amp;#8217;s frivolous. But maybe it&amp;#8217;ll save you some trouble.&lt;/p&gt;

&lt;p&gt;&lt;a href='https://github.com/joeyAghion/console_color'&gt;Visit console_color on GitHub for more details.&lt;/a&gt;&lt;/p&gt;</content>
  </entry>
  <entry>
    <title>Artsy's experiment with AWS OpsWorks</title>
    <link rel="alternate" href="/artsy-s-experiment-with-aws-opsworks/"/>
    <id>/artsy-s-experiment-with-aws-opsworks/</id>
    <published>2013-09-13T04:53:00Z</published>
    <updated>2013-09-13T04:53:00Z</updated>
    <author>
      <name>Joey Aghion</name>
    </author>
    <summary type="html">&lt;p&gt;After struggling to make Artsy&amp;#8217;s largest application work within &lt;a href='https://www.heroku.com/'&gt;Heroku&amp;#8217;s&lt;/a&gt; platform for a long while, I began a series of experiments with other providers. Recently, those experiments culminated in switching our application to &lt;a href='http://aws.amazon.com/opsworks/'&gt;AWS OpsWorks&lt;/a&gt;.&lt;/p&gt;</summary>
    <content type="html">&lt;p&gt;After struggling to make Artsy&amp;#8217;s largest application work within &lt;a href='https://www.heroku.com/'&gt;Heroku&amp;#8217;s&lt;/a&gt; platform for a long while, I began a series of experiments with other providers. Recently, those experiments culminated in switching our application to &lt;a href='http://aws.amazon.com/opsworks/'&gt;AWS OpsWorks&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;OpsWorks offered us much more control, but balanced that with good automation and plenty of sane defaults. To help others up the learning curve I wrote an &lt;a href='http://artsy.github.io/blog/2013/08/27/introduction-to-aws-opsworks/'&gt;Introduction to AWS OpsWorks&lt;/a&gt; for the Artsy engineering blog.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;OpsWorks is a new service from Amazon that promises to provide high-level tools to manage your EC2-based deployment&amp;#8230;. If you&amp;#8217;ve been straining at the limits of your Platform as a Service (PaaS) provider, or just wishing for more automation for your EC2 deployment, you may want to try it out too.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;We&amp;#8217;re all primarily developers, not system administrators. So over the next few months we&amp;#8217;ll be keeping a close watch on how much additional administrative overhead our new platform requires. So far, results have been very promising.&lt;/p&gt;

&lt;p&gt;&lt;a href='http://artsy.github.io/blog/2013/08/27/introduction-to-aws-opsworks/'&gt;Continue reading&lt;/a&gt; or visit the &lt;a href='https://news.ycombinator.com/item?id=6297992'&gt;Hacker News comments&lt;/a&gt;.&lt;/p&gt;</content>
  </entry>
  <entry>
    <title>Listing MongoDB collections by size</title>
    <link rel="alternate" href="/listing-mongodb-collections-by-size/"/>
    <id>/listing-mongodb-collections-by-size/</id>
    <published>2013-09-10T15:37:00Z</published>
    <updated>2013-09-10T15:37:00Z</updated>
    <author>
      <name>Joey Aghion</name>
    </author>
    <summary type="html">&lt;p&gt;In a MongoDB shell, the &lt;code&gt;db.stats()&lt;/code&gt; command shows you the amount of space occupied by the selected database.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt; db.stats()
{
  &amp;quot;db&amp;quot; : &amp;quot;my-db&amp;quot;,
  &amp;quot;collections&amp;quot; : 242,
  &amp;quot;dataSize&amp;quot; : 7167367172,&lt;/code&gt;&lt;/pre&gt;</summary>
    <content type="html">&lt;p&gt;In a MongoDB shell, the &lt;code&gt;db.stats()&lt;/code&gt; command shows you the amount of space occupied by the selected database.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt; db.stats()
{
  &amp;quot;db&amp;quot; : &amp;quot;my-db&amp;quot;,
  &amp;quot;collections&amp;quot; : 242,
  &amp;quot;dataSize&amp;quot; : 7167367172,
  &amp;quot;storageSize&amp;quot; : 7885074432,
   ...
  &amp;quot;fileSize&amp;quot; : 14958985216,
  &amp;quot;nsSizeMB&amp;quot; : 16,
  &amp;quot;ok&amp;quot; : 1
}&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The &lt;code&gt;db.collection_name.stats()&lt;/code&gt; command returns similar metrics for an individual collection, but there&amp;#8217;s no convenient way to see how the overall metrics are broken down by collection.&lt;/p&gt;

&lt;h3 id='my_solution'&gt;My Solution&lt;/h3&gt;

&lt;p&gt;This javascript lists collections in descending order of size and can be executed directly in the mongo shell:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var collectionNames = db.getCollectionNames(), stats = [];
collectionNames.forEach(function (n) { stats.push(db[n].stats()); });
stats = stats.sort(function(a, b) { return b[&amp;#39;size&amp;#39;] - a[&amp;#39;size&amp;#39;]; });
for (var c in stats) { print(stats[c][&amp;#39;ns&amp;#39;] + &amp;quot;: &amp;quot; + stats[c][&amp;#39;size&amp;#39;] + &amp;quot; (&amp;quot; + stats[c][&amp;#39;storageSize&amp;#39;] + &amp;quot;)&amp;quot;); }&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or, see the gist: &lt;a href='https://gist.github.com/joeyAghion/6511184'&gt;mongodb_collection_sizes.js&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Example output (first metric is &lt;code&gt;size&lt;/code&gt;, second is &lt;code&gt;storageSize&lt;/code&gt;):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;my-db.foos: 5568196496 (7455608832)
my-db.bars: 716999376 (929259520)
...
my-db.bazs: 0 (8192)&lt;/code&gt;&lt;/pre&gt;</content>
  </entry>
  <entry>
    <title>Simple 301 redirects</title>
    <link rel="alternate" href="/simple-301-redirects/"/>
    <id>/simple-301-redirects/</id>
    <published>2013-07-12T14:08:00Z</published>
    <updated>2013-07-12T14:08:00Z</updated>
    <author>
      <name>Joey Aghion</name>
    </author>
    <summary type="html">&lt;p&gt;When I switched from &lt;a href='http://halfamind.aghion.com'&gt;halfamind.aghion.com&lt;/a&gt; to the more personal &lt;a href='http://joey.aghion.com'&gt;joey.aghion.com&lt;/a&gt; for this site, I needed a way to permanently redirect all requests for the old hostname to the new one. &lt;a href='http://pages.github.com'&gt;Github pages&lt;/a&gt; (where this is hosted) only supports a single hostname and doesn&amp;#8217;t allow for redirects. You could redirect &lt;a href='http://stackoverflow.com/questions/9276817/301-redirect-for-site-hosted-at-github'&gt;in javascript&lt;/a&gt; or with a meta-tag, but I wanted to guarantee that search engines would respect the new location.&lt;/p&gt;</summary>
    <content type="html">&lt;p&gt;When I switched from &lt;a href='http://halfamind.aghion.com'&gt;halfamind.aghion.com&lt;/a&gt; to the more personal &lt;a href='http://joey.aghion.com'&gt;joey.aghion.com&lt;/a&gt; for this site, I needed a way to permanently redirect all requests for the old hostname to the new one. &lt;a href='http://pages.github.com'&gt;Github pages&lt;/a&gt; (where this is hosted) only supports a single hostname and doesn&amp;#8217;t allow for redirects. You could redirect &lt;a href='http://stackoverflow.com/questions/9276817/301-redirect-for-site-hosted-at-github'&gt;in javascript&lt;/a&gt; or with a meta-tag, but I wanted to guarantee that search engines would respect the new location.&lt;/p&gt;

&lt;p&gt;&lt;a href='http://github.com/joeyAghion/rerouter'&gt;Rerouter&lt;/a&gt; is a simple rack app that accepts a map of source and destination hostnames. When it receives a request matching a source hostname, it issues a 301 (permanent) redirect to the new hostname while preserving the requested path and querystring.&lt;/p&gt;

&lt;p&gt;The complete source is incredibly simple.&lt;/p&gt;

&lt;h3 id='configru'&gt;config.ru&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;require &amp;#39;rack/rewrite&amp;#39;

# Expects ENV[&amp;#39;REDIRECTS&amp;#39;] to be a ruby hash of source =&amp;gt; destination hostnames. E.g.:
#   &amp;quot;{&amp;#39;old.domain.com&amp;#39; =&amp;gt; &amp;#39;new.domain.com&amp;#39;}&amp;quot;
REDIRECTS = eval(ENV[&amp;#39;REDIRECTS&amp;#39;] || &amp;#39;&amp;#39;) || {}

use Rack::Rewrite do

  REDIRECTS.each do |from, to|
    r301 %r{.*}, &amp;quot;http://#{to}$&amp;amp;&amp;quot;, if: -&amp;gt; (env) { env[&amp;#39;SERVER_NAME&amp;#39;] == from }
  end

end

# Fall back to default app (empty).
run -&amp;gt; (env) { [200, {}, []] }&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id='steps_for_setting_up_your_own_rerouter_on_heroku'&gt;Steps for setting up your own rerouter on Heroku:&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;git clone https://github.com/joeyAghion/rerouter.git
cd rerouter
gem install heroku
heroku apps:create
git push heroku master
heroku config:set REDIRECTS=&amp;quot;{&amp;#39;old.domain.com&amp;#39;=&amp;gt;&amp;#39;new.domain.com&amp;#39;}&amp;quot;
heroku domains:add old.domain.com&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then, update the DNS of &lt;code&gt;old.domain.com&lt;/code&gt; to be a CNAME pointing to the new heroku app.&lt;/p&gt;</content>
  </entry>
  <entry>
    <title>Eliminating TextMate Lag</title>
    <link rel="alternate" href="/eliminating-textmate-lag/"/>
    <id>/eliminating-textmate-lag/</id>
    <published>2013-05-21T16:12:00Z</published>
    <updated>2013-05-21T16:12:00Z</updated>
    <author>
      <name>Joey Aghion</name>
    </author>
    <summary type="html">&lt;p&gt;I&amp;#8217;m still using &lt;a href='http://macromates.com/'&gt;TextMate 1&lt;/a&gt;, since 2.0 has been buggy for me. If you&amp;#8217;re in the same boat, you might share my frustration with the recurring lag that TextMate experiences when switching focus between applications. TextMate tries to reload the entire project&amp;#8217;s file state on focus, and this can be noticeably slow.&lt;/p&gt;</summary>
    <content type="html">&lt;p&gt;I&amp;#8217;m still using &lt;a href='http://macromates.com/'&gt;TextMate 1&lt;/a&gt;, since 2.0 has been buggy for me. If you&amp;#8217;re in the same boat, you might share my frustration with the recurring lag that TextMate experiences when switching focus between applications. TextMate tries to reload the entire project&amp;#8217;s file state on focus, and this can be noticeably slow.&lt;/p&gt;

&lt;p&gt;These tips have eliminated the problem for me. Feel free to mix and match:&lt;/p&gt;

&lt;h3 id='avoid_loading_the_entire_project_directory'&gt;Avoid loading the entire project directory&lt;/h3&gt;

&lt;p&gt;If you&amp;#8217;re working with a Rails project, you can avoid loading the heavy &lt;code&gt;log/&lt;/code&gt; and &lt;code&gt;tmp/&lt;/code&gt; directories with the &lt;code&gt;mater&lt;/code&gt; alias. Just put this in one of your shell start-up scripts:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;alias mater=&amp;quot;ls | grep -Ev &amp;#39;log|tmp&amp;#39; | xargs mate&amp;quot;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Adjust for other project types.&lt;/p&gt;

&lt;h3 id='disable_project_tree_refresh_with_remate'&gt;Disable project tree refresh with ReMate&lt;/h3&gt;

&lt;p&gt;&lt;a href='http://ciaranwal.sh/remate/'&gt;The ReMate plugin&lt;/a&gt; adds a &lt;em&gt;Disable Refresh on Regaining Focus&lt;/em&gt; item to the &lt;em&gt;Window&lt;/em&gt; menu. Download and extract the plugin, double click to add to TextMate, and relaunch TextMate. Then, check the new menu option to disable the project refresh behavior entirely. (You can always temporarily uncheck it to refresh the project state.)&lt;/p&gt;</content>
  </entry>
</feed>
